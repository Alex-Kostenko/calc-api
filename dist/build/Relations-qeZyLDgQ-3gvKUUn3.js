import{h1 as He,h2 as pe,r as C,h3 as qe,d as Q,F as B,b as Ke,cb as Ve,cn as ye,u as V,a9 as de,cj as ue,bk as ee,ah as J,cl as te,co as Se,j as c,bo as me,er as F,_ as Re,i as Ge,h4 as Ye,W as Z,ai as Qe,aj as Je,T as Ce,ct as he,cy as ie,V as ne,B as q,eQ as xe,I as oe,eR as Me,aw as Te,bj as we,aE as Xe}from"./strapi-BgWwigF4.js";import{u as De,I as Le,D as Oe}from"./useDragAndDrop-HYwNDExe-DZkH0a1L.js";import{a as je,g as se,u as Ze,b as et}from"./relations-Cq8NRUto-CWuuoqtV.js";import{g as Fe}from"./getEmptyImage-CjqolaH3.js";var ge=Number.isNaN||function(n){return typeof n=="number"&&n!==n};function tt(t,n){return!!(t===n||ge(t)&&ge(n))}function nt(t,n){if(t.length!==n.length)return!1;for(var o=0;o<t.length;o++)if(!tt(t[o],n[o]))return!1;return!0}function le(t,n){n===void 0&&(n=nt);var o,d=[],m,I=!1;function R(){for(var y=[],M=0;M<arguments.length;M++)y[M]=arguments[M];return I&&o===this&&n(y,d)||(m=t.apply(this,y),I=!0,o=this,d=y),m}return R}var ot=typeof performance=="object"&&typeof performance.now=="function",ve=ot?function(){return performance.now()}:function(){return Date.now()};function be(t){cancelAnimationFrame(t.id)}function it(t,n){var o=ve();function d(){ve()-o>=n?t.call(null):m.id=requestAnimationFrame(d)}var m={id:requestAnimationFrame(d)};return m}var ce=-1;function _e(t){if(t===void 0&&(t=!1),ce===-1||t){var n=document.createElement("div"),o=n.style;o.width="50px",o.height="50px",o.overflow="scroll",document.body.appendChild(n),ce=n.offsetWidth-n.clientWidth,document.body.removeChild(n)}return ce}var Y=null;function Ie(t){if(t===void 0&&(t=!1),Y===null||t){var n=document.createElement("div"),o=n.style;o.width="50px",o.height="50px",o.overflow="scroll",o.direction="rtl";var d=document.createElement("div"),m=d.style;return m.width="100px",m.height="100px",n.appendChild(d),document.body.appendChild(n),n.scrollLeft>0?Y="positive-descending":(n.scrollLeft=1,n.scrollLeft===0?Y="negative":Y="positive-ascending"),document.body.removeChild(n),Y}return Y}var st=150,at=function(n,o){return n};function rt(t){var n,o=t.getItemOffset,d=t.getEstimatedTotalSize,m=t.getItemSize,I=t.getOffsetForIndexAndAlignment,R=t.getStartIndexForOffset,y=t.getStopIndexForStartIndex,M=t.initInstanceProps,w=t.shouldResetStyleCacheOnItemSizeChange,O=t.validateProps;return n=function(T){He(L,T);function L(v){var e;return e=T.call(this,v)||this,e._instanceProps=M(e.props,pe(e)),e._outerRef=void 0,e._resetIsScrollingTimeoutId=null,e.state={instance:pe(e),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof e.props.initialScrollOffset=="number"?e.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},e._callOnItemsRendered=void 0,e._callOnItemsRendered=le(function(r,l,h,p){return e.props.onItemsRendered({overscanStartIndex:r,overscanStopIndex:l,visibleStartIndex:h,visibleStopIndex:p})}),e._callOnScroll=void 0,e._callOnScroll=le(function(r,l,h){return e.props.onScroll({scrollDirection:r,scrollOffset:l,scrollUpdateWasRequested:h})}),e._getItemStyle=void 0,e._getItemStyle=function(r){var l=e.props,h=l.direction,p=l.itemSize,u=l.layout,f=e._getItemStyleCache(w&&p,w&&u,w&&h),b;if(f.hasOwnProperty(r))b=f[r];else{var i=o(e.props,r,e._instanceProps),s=m(e.props,r,e._instanceProps),S=h==="horizontal"||u==="horizontal",g=h==="rtl",$=S?i:0;f[r]=b={position:"absolute",left:g?void 0:$,right:g?$:void 0,top:S?0:i,height:S?"100%":s,width:S?s:"100%"}}return b},e._getItemStyleCache=void 0,e._getItemStyleCache=le(function(r,l,h){return{}}),e._onScrollHorizontal=function(r){var l=r.currentTarget,h=l.clientWidth,p=l.scrollLeft,u=l.scrollWidth;e.setState(function(f){if(f.scrollOffset===p)return null;var b=e.props.direction,i=p;if(b==="rtl")switch(Ie()){case"negative":i=-p;break;case"positive-descending":i=u-h-p;break}return i=Math.max(0,Math.min(i,u-h)),{isScrolling:!0,scrollDirection:f.scrollOffset<i?"forward":"backward",scrollOffset:i,scrollUpdateWasRequested:!1}},e._resetIsScrollingDebounced)},e._onScrollVertical=function(r){var l=r.currentTarget,h=l.clientHeight,p=l.scrollHeight,u=l.scrollTop;e.setState(function(f){if(f.scrollOffset===u)return null;var b=Math.max(0,Math.min(u,p-h));return{isScrolling:!0,scrollDirection:f.scrollOffset<b?"forward":"backward",scrollOffset:b,scrollUpdateWasRequested:!1}},e._resetIsScrollingDebounced)},e._outerRefSetter=function(r){var l=e.props.outerRef;e._outerRef=r,typeof l=="function"?l(r):l!=null&&typeof l=="object"&&l.hasOwnProperty("current")&&(l.current=r)},e._resetIsScrollingDebounced=function(){e._resetIsScrollingTimeoutId!==null&&be(e._resetIsScrollingTimeoutId),e._resetIsScrollingTimeoutId=it(e._resetIsScrolling,st)},e._resetIsScrolling=function(){e._resetIsScrollingTimeoutId=null,e.setState({isScrolling:!1},function(){e._getItemStyleCache(-1,null)})},e}L.getDerivedStateFromProps=function(e,r){return lt(e,r),O(e),null};var _=L.prototype;return _.scrollTo=function(e){e=Math.max(0,e),this.setState(function(r){return r.scrollOffset===e?null:{scrollDirection:r.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},_.scrollToItem=function(e,r){r===void 0&&(r="auto");var l=this.props,h=l.itemCount,p=l.layout,u=this.state.scrollOffset;e=Math.max(0,Math.min(e,h-1));var f=0;if(this._outerRef){var b=this._outerRef;p==="vertical"?f=b.scrollWidth>b.clientWidth?_e():0:f=b.scrollHeight>b.clientHeight?_e():0}this.scrollTo(I(this.props,e,r,u,this._instanceProps,f))},_.componentDidMount=function(){var e=this.props,r=e.direction,l=e.initialScrollOffset,h=e.layout;if(typeof l=="number"&&this._outerRef!=null){var p=this._outerRef;r==="horizontal"||h==="horizontal"?p.scrollLeft=l:p.scrollTop=l}this._callPropsCallbacks()},_.componentDidUpdate=function(){var e=this.props,r=e.direction,l=e.layout,h=this.state,p=h.scrollOffset,u=h.scrollUpdateWasRequested;if(u&&this._outerRef!=null){var f=this._outerRef;if(r==="horizontal"||l==="horizontal")if(r==="rtl")switch(Ie()){case"negative":f.scrollLeft=-p;break;case"positive-ascending":f.scrollLeft=p;break;default:var b=f.clientWidth,i=f.scrollWidth;f.scrollLeft=i-b-p;break}else f.scrollLeft=p;else f.scrollTop=p}this._callPropsCallbacks()},_.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&be(this._resetIsScrollingTimeoutId)},_.render=function(){var e=this.props,r=e.children,l=e.className,h=e.direction,p=e.height,u=e.innerRef,f=e.innerElementType,b=e.innerTagName,i=e.itemCount,s=e.itemData,S=e.itemKey,g=S===void 0?at:S,$=e.layout,z=e.outerElementType,A=e.outerTagName,E=e.style,x=e.useIsScrolling,D=e.width,a=this.state.isScrolling,j=h==="horizontal"||$==="horizontal",N=j?this._onScrollHorizontal:this._onScrollVertical,P=this._getRangeToRender(),k=P[0],U=P[1],G=[];if(i>0)for(var X=k;X<=U;X++)G.push(C.createElement(r,{data:s,key:g(X,s),index:X,isScrolling:x?a:void 0,style:this._getItemStyle(X)}));var fe=d(this.props,this._instanceProps);return C.createElement(z||A||"div",{className:l,onScroll:N,ref:this._outerRefSetter,style:qe({position:"relative",height:p,width:D,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:h},E)},C.createElement(f||b||"div",{children:G,ref:u,style:{height:j?"100%":fe,pointerEvents:a?"none":void 0,width:j?fe:"100%"}}))},_._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var e=this.props.itemCount;if(e>0){var r=this._getRangeToRender(),l=r[0],h=r[1],p=r[2],u=r[3];this._callOnItemsRendered(l,h,p,u)}}if(typeof this.props.onScroll=="function"){var f=this.state,b=f.scrollDirection,i=f.scrollOffset,s=f.scrollUpdateWasRequested;this._callOnScroll(b,i,s)}},_._getRangeToRender=function(){var e=this.props,r=e.itemCount,l=e.overscanCount,h=this.state,p=h.isScrolling,u=h.scrollDirection,f=h.scrollOffset;if(r===0)return[0,0,0,0];var b=R(this.props,f,this._instanceProps),i=y(this.props,b,f,this._instanceProps),s=!p||u==="backward"?Math.max(1,l):1,S=!p||u==="forward"?Math.max(1,l):1;return[Math.max(0,b-s),Math.max(0,Math.min(r-1,i+S)),b,i]},L}(C.PureComponent),n.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},n}var lt=function(n,o){n.children,n.direction,n.height,n.layout,n.innerTagName,n.outerTagName,n.width,o.instance},ke=rt({getItemOffset:function(n,o){var d=n.itemSize;return o*d},getItemSize:function(n,o){var d=n.itemSize;return d},getEstimatedTotalSize:function(n){var o=n.itemCount,d=n.itemSize;return d*o},getOffsetForIndexAndAlignment:function(n,o,d,m,I,R){var y=n.direction,M=n.height,w=n.itemCount,O=n.itemSize,T=n.layout,L=n.width,_=y==="horizontal"||T==="horizontal",v=_?L:M,e=Math.max(0,w*O-v),r=Math.min(e,o*O),l=Math.max(0,o*O-v+O+R);switch(d==="smart"&&(m>=l-v&&m<=r+v?d="auto":d="center"),d){case"start":return r;case"end":return l;case"center":{var h=Math.round(l+(r-l)/2);return h<Math.ceil(v/2)?0:h>e+Math.floor(v/2)?e:h}case"auto":default:return m>=l&&m<=r?m:m<l?l:r}},getStartIndexForOffset:function(n,o){var d=n.itemCount,m=n.itemSize;return Math.max(0,Math.min(d-1,Math.floor(o/m)))},getStopIndexForStartIndex:function(n,o,d){var m=n.direction,I=n.height,R=n.itemCount,y=n.itemSize,M=n.layout,w=n.width,O=m==="horizontal"||M==="horizontal",T=o*y,L=O?w:I,_=Math.ceil((L+d-T)/y);return Math.max(0,Math.min(R-1,o+_-1))},initInstanceProps:function(n){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(n){n.itemSize}});const[yt,$e]=Ve("ComponentContext",{id:void 0,level:-1,uid:void 0,type:void 0});function ae(t,n){const o=J(t),d=ee(n,R=>R.removeFieldRow),m=ee(n,R=>R.addFieldRow);return R=>{if(o.value&&o.value.connect){const y=o.value.connect.findIndex(M=>M.id===R.id);if(y>=0){d(`${t}.connect`,y);return}}m(`${t}.disconnect`,{id:R.id,apiData:{id:R.id,documentId:R.documentId,locale:R.locale}})}}const W=5,re=["oneWay","oneToOne","manyToOne","oneToManyMorph","oneToOneMorph"],ct=C.forwardRef(({disabled:t,label:n,...o},d)=>{const[m,I]=C.useState(1),{document:R,model:y}=ye(),M=R?.documentId,{formatMessage:w}=V(),[{query:O}]=de(),T=ue(O),_=o.attribute.relation.toLowerCase().includes("morph")||t,{componentId:v,componentUID:e}=$e("RelationsField",({uid:a,id:j})=>({componentId:j,componentUID:a})),r=ee("RelationsList",a=>a.isSubmitting);C.useEffect(()=>{I(1)},[r]);const l=v?v.toString():M,h=e??y,[p]=o.name.split(".").slice(-1),{data:u,isLoading:f,isFetching:b}=je({model:h,targetField:p,id:l,params:{...T,pageSize:W,page:m}},{refetchOnMountOrArgChange:!0,skip:!l,selectFromResult:a=>({...a,data:{...a.data,results:a.data?.results?a.data.results:[]}})}),i=()=>{I(a=>a+1)},s=J(o.name),S=f||b,g="pagination"in u&&u.pagination?u.pagination.total:0,$=(s.value?.connect??[]).filter(a=>u.results.findIndex(j=>j.id===a.id)===-1).length??0,z=s.value?.disconnect?.length??0,A=g+$-z,E=C.useMemo(()=>{const a={field:s.value,href:`../${te}/${o.attribute.targetModel}`,mainField:o.mainField};return[...Se(Ee(a),Pe(a),Ae(a))([...u.results]),...s.value?.connect??[]].sort((P,k)=>P.__temp_key__<k.__temp_key__?-1:P.__temp_key__>k.__temp_key__?1:0)},[u.results,s.value,o.attribute.targetModel,o.mainField]),x=ae(o.name,"RelationsField"),D=a=>{const[j]=E.slice(-1),N={id:a.id,apiData:{id:a.id,documentId:a.documentId,locale:a.locale},status:a.status,__temp_key__:ie(j?.__temp_key__??null,null,1)[0],[o.mainField?.name??"documentId"]:a[o.mainField?.name??"documentId"],label:se(a,o.mainField),href:`../${te}/${o.attribute.targetModel}/${a.documentId}?${a.locale?`plugins[i18n][locale]=${a.locale}`:""}`};re.includes(o.attribute.relation)?(s.value?.connect?.forEach(x),E.forEach(x),s.onChange(`${o.name}.connect`,[N])):s.onChange(`${o.name}.connect`,[...s.value?.connect??[],N])};return c.jsxs(B,{ref:d,direction:"column",gap:3,justifyContent:"space-between",alignItems:"stretch",wrap:"wrap",children:[c.jsxs(ze,{direction:"column",alignItems:"start",gap:2,width:"100%",children:[c.jsx(Ne,{disabled:_,id:e?v?`${v}`:"":M,label:`${n} ${A>0?`(${A})`:""}`,model:h,onChange:D,...o}),"pagination"in u&&u.pagination&&u.pagination.pageCount>u.pagination.page?c.jsx(me,{disabled:S,onClick:i,loading:S,startIcon:c.jsx(Re,{}),shrink:0,children:w({id:F("relation.loadMore"),defaultMessage:"Load More"})}):null]}),c.jsx(ut,{data:E,serverData:u.results,disabled:_,name:o.name,isLoading:S,relationType:o.attribute.relation})]})}),dt=C.forwardRef(({disabled:t,label:n,...o},d)=>{const[m,I]=C.useState(1),{document:R,model:y}=ye(),M=R?.documentId,{formatMessage:w}=V(),[{query:O}]=de(),T=ue(O),_=o.attribute.relation.toLowerCase().includes("morph")||t,{componentId:v,componentUID:e}=$e("RelationsField",({uid:a,id:j})=>({componentId:j,componentUID:a})),r=ee("RelationsList",a=>a.isSubmitting);C.useEffect(()=>{I(1)},[r]);const l=v?v.toString():M,h=e??y,[p]=o.name.split(".").slice(-1),{data:u,isLoading:f,isFetching:b}=je({model:h,targetField:p,id:l,params:{...T,pageSize:W,page:m}},{refetchOnMountOrArgChange:!0,skip:!l,selectFromResult:a=>({...a,data:{...a.data,results:a.data?.results?a.data.results:[]}})}),i=()=>{I(a=>a+1)},s=J(o.name),S=f||b,g="pagination"in u&&u.pagination?u.pagination.total:0,$=(s.value?.connect??[]).filter(a=>u.results.findIndex(j=>j.id===a.id)===-1).length??0,z=s.value?.disconnect?.length??0,A=g+$-z,E=C.useMemo(()=>{const a={field:s.value,href:`../${te}/${o.attribute.targetModel}`,mainField:o.mainField};return[...Se(Ee(a),Pe(a),Ae(a))([...u.results]),...s.value?.connect??[]].sort((P,k)=>P.__temp_key__<k.__temp_key__?-1:P.__temp_key__>k.__temp_key__?1:0)},[u.results,s.value,o.attribute.targetModel,o.mainField]),x=ae(o.name,"RelationsField"),D=a=>{const[j]=E.slice(-1),N={id:a.id,apiData:{id:a.id,documentId:a.documentId,locale:a.locale},status:a.status,__temp_key__:ie(j?.__temp_key__??null,null,1)[0],[o.mainField?.name??"documentId"]:a[o.mainField?.name??"documentId"],label:se(a,o.mainField),href:`../${te}/${o.attribute.targetModel}/${a.documentId}?${a.locale?`plugins[i18n][locale]=${a.locale}`:""}`};re.includes(o.attribute.relation)?(s.value?.connect?.forEach(x),E.forEach(x),s.onChange(`${o.name}.connect`,[N])):s.onChange(`${o.name}.connect`,[...s.value?.connect??[],N])};return c.jsxs(B,{ref:d,direction:"column",gap:3,justifyContent:"space-between",alignItems:"stretch",wrap:"wrap",children:[c.jsxs(ze,{direction:"column",alignItems:"start",gap:2,width:"100%",children:[c.jsx(Ne,{disabled:_,id:e?v?`${v}`:"":M,label:`${n} ${A>0?`(${A})`:""}`,model:h,onChange:D,...o}),"pagination"in u&&u.pagination&&u.pagination.pageCount>u.pagination.page?c.jsx(me,{disabled:S,onClick:i,loading:S,startIcon:c.jsx(Re,{}),shrink:0,children:w({id:F("relation.loadMore"),defaultMessage:"Load More"})}):null]}),c.jsx(mt,{data:E,serverData:u.results,disabled:_,name:o.name,isLoading:S,relationType:o.attribute.relation})]})}),ze=Q(B)`
  & > div {
    width: 100%;
  }
`,Ee=({field:t})=>n=>n.filter(o=>(t?.connect??[]).findIndex(m=>m.id===o.id)===-1),Pe=({field:t})=>n=>n.filter(o=>(t?.disconnect??[]).findIndex(m=>m.id===o.id)===-1),Ae=({mainField:t,href:n})=>o=>o.map(d=>({...d,[t?.name??"documentId"]:d[t?.name??"documentId"],label:se(d,t),href:`${n}/${d.documentId}?${d.locale?`plugins[i18n][locale]=${d.locale}`:""}`})),Ne=({hint:t,id:n,model:o,label:d,labelAction:m,name:I,mainField:R,placeholder:y,required:M,unique:w,"aria-label":O,onChange:T,...L})=>{const[_,v]=C.useState(""),[e,r]=C.useState({_q:"",page:1}),{toggleNotification:l}=Ge(),[{query:h}]=de(),{formatMessage:p}=V(),u=Ye(I),f=J(I),b=Ze(e,300),[i,{data:s,isLoading:S}]=et();C.useEffect(()=>{const[x]=I.split(".").slice(-1);i({model:o,targetField:x,params:{...ue(h),id:n??"",pageSize:10,idsToInclude:f.value?.disconnect?.map(D=>D.id.toString())??[],idsToOmit:f.value?.connect?.map(D=>D.id.toString())??[],...b}})},[f.value?.connect,f.value?.disconnect,n,o,I,h,i,b]);const g=async x=>{r(D=>({...D,_q:x,page:1}))},$=s?.pagination?s.pagination.page<s.pagination.pageCount:!1,z=s?.results??[],A=x=>{if(!x)return;const D=z.find(a=>a.id.toString()===x);if(!D){console.error("You've tried to add a relation with an id that does not exist in the options you can see, this is likely a bug with Strapi. Please open an issue."),l({message:p({id:F("relation.error-adding-relation"),defaultMessage:"An error occurred while trying to add the relation."}),type:"danger"});return}T(D)},E=()=>{!s||!s.pagination||s.pagination.page<s.pagination.pageCount&&r(x=>({...x,page:x.page+1}))};return C.useLayoutEffect(()=>{v("")},[f.value]),c.jsxs(Z.Root,{error:f.error,hint:t,name:I,required:M,children:[c.jsx(Z.Label,{action:m,children:d}),c.jsx(Qe,{ref:u,name:I,autocomplete:"list",placeholder:y||p({id:F("relation.add"),defaultMessage:"Add relation"}),hasMoreItems:$,loading:S,onOpenChange:()=>{g(_??"")},noOptionsMessage:()=>p({id:F("relation.notAvailable"),defaultMessage:"No relations available"}),loadingMessage:p({id:F("relation.isLoading"),defaultMessage:"Relations are loading"}),onLoadMore:E,textValue:_,onChange:A,onTextValueChange:x=>{v(x)},onInputChange:x=>{g(x.currentTarget.value)},...L,children:z.map(x=>{const D=se(x,R);return c.jsx(Je,{value:x.id.toString(),textValue:D,children:c.jsxs(B,{gap:2,justifyContent:"space-between",children:[c.jsx(Ce,{ellipsis:!0,children:D}),x.status?c.jsx(he,{status:x.status}):null]})},x.id)})}),c.jsx(Z.Error,{}),c.jsx(Z.Hint,{})]})},H=50,K=4,ut=({data:t,serverData:n,disabled:o,name:d,isLoading:m,relationType:I})=>{const R=C.useId(),{formatMessage:y}=V(),M=C.useRef(null),w=C.useRef(null),[O,T]=C.useState(),[L,_]=C.useState(""),v=J(d);C.useEffect(()=>{if(t.length<=W)return T(void 0);const i=S=>{const g=S.target,$=g.parentNode.scrollHeight,z=g.scrollHeight-g.scrollTop;return g.scrollTop===0?T("bottom"):T(z===$?"top":"top-bottom")},s=w?.current;return!m&&t.length>0&&s&&w.current.addEventListener("scroll",i),()=>{s&&s.removeEventListener("scroll",i)}},[m,t.length]);const e=i=>`${i+1} of ${t.length}`,r=(i,s)=>{const S=t[s];_(y({id:F("dnd.reorder"),defaultMessage:"{item}, moved. New position in list: {position}."},{item:S.label??S.documentId,position:e(i)}));const g=[...t],$=t[s],z=s>i?g[i-1]?.__temp_key__:g[i]?.__temp_key__,A=s>i?g[i]?.__temp_key__:g[i+1]?.__temp_key__,[E]=ie(z,A,1);g.splice(s,1),g.splice(i,0,{...$,__temp_key__:E});const x=g.reduce((D,a,j,N)=>{const P=n.find(U=>U.id===a.id),k=N[j+1];if(!P||P.__temp_key__!==a.__temp_key__){const U=k?{before:k.documentId,locale:k.locale,status:"publishedAt"in k&&k.publishedAt?"published":"draft"}:{end:!0},G={...a,apiData:{id:a.id,documentId:a.documentId,locale:a.locale,position:U}};return[...D,G]}return D},[]).toReversed();v.onChange(`${d}.connect`,x)},l=i=>{const s=t[i];_(y({id:F("dnd.grab-item"),defaultMessage:"{item}, grabbed. Current position in list: {position}. Press up and down arrow to change position, Spacebar to drop, Escape to cancel."},{item:s.label??s.documentId,position:e(i)}))},h=i=>{const{href:s,label:S,...g}=t[i];_(y({id:F("dnd.drop-item"),defaultMessage:"{item}, dropped. Final position in list: {position}."},{item:S??g.documentId,position:e(i)}))},p=i=>{const s=t[i];_(y({id:F("dnd.cancel-item"),defaultMessage:"{item}, dropped. Re-order cancelled."},{item:s.label??s.documentId}))},u=ae(d,"RelationsList"),f=!re.includes(I),b=t.length>W?Math.min(t.length,W)*(H+K)+H/2:Math.min(t.length,W)*(H+K);return c.jsxs(We,{$overflowDirection:O,children:[c.jsx(ne,{id:R,children:y({id:F("dnd.instructions"),defaultMessage:"Press spacebar to grab and re-order"})}),c.jsx(ne,{"aria-live":"assertive",children:L}),c.jsx(ke,{height:b,ref:M,outerRef:w,itemCount:t.length,itemSize:H+K,itemData:{ariaDescribedBy:R,canDrag:f,disabled:o,handleCancel:p,handleDropItem:h,handleGrabItem:l,handleMoveItem:r,name:d,handleDisconnect:u,relations:t},itemKey:i=>t[i].id,innerElementType:"ol",children:ft})]})},mt=({data:t,serverData:n,disabled:o,name:d,isLoading:m,relationType:I})=>{const R=C.useId(),{formatMessage:y}=V(),M=C.useRef(null),w=C.useRef(null),[O,T]=C.useState(),[L,_]=C.useState(""),v=J(d);C.useEffect(()=>{if(t.length<=W)return T(void 0);const i=S=>{const g=S.target,$=g.parentNode.scrollHeight,z=g.scrollHeight-g.scrollTop;return g.scrollTop===0?T("bottom"):T(z===$?"top":"top-bottom")},s=w?.current;return!m&&t.length>0&&s&&w.current.addEventListener("scroll",i),()=>{s&&s.removeEventListener("scroll",i)}},[m,t.length]);const e=i=>`${i+1} of ${t.length}`,r=(i,s)=>{const S=t[s];_(y({id:F("dnd.reorder"),defaultMessage:"{item}, moved. New position in list: {position}."},{item:S.label??S.documentId,position:e(i)}));const g=[...t],$=t[s],z=s>i?g[i-1]?.__temp_key__:g[i]?.__temp_key__,A=s>i?g[i]?.__temp_key__:g[i+1]?.__temp_key__,[E]=ie(z,A,1);g.splice(s,1),g.splice(i,0,{...$,__temp_key__:E});const x=g.reduce((D,a,j,N)=>{const P=n.find(U=>U.id===a.id),k=N[j+1];if(!P||P.__temp_key__!==a.__temp_key__){const U=k?{before:k.documentId,locale:k.locale,status:"publishedAt"in k&&k.publishedAt?"published":"draft"}:{end:!0},G={...a,apiData:{id:a.id,documentId:a.documentId,locale:a.locale,position:U}};return[...D,G]}return D},[]).toReversed();v.onChange(`${d}.connect`,x)},l=i=>{const s=t[i];_(y({id:F("dnd.grab-item"),defaultMessage:"{item}, grabbed. Current position in list: {position}. Press up and down arrow to change position, Spacebar to drop, Escape to cancel."},{item:s.label??s.documentId,position:e(i)}))},h=i=>{const{href:s,label:S,...g}=t[i];_(y({id:F("dnd.drop-item"),defaultMessage:"{item}, dropped. Final position in list: {position}."},{item:S??g.documentId,position:e(i)}))},p=i=>{const s=t[i];_(y({id:F("dnd.cancel-item"),defaultMessage:"{item}, dropped. Re-order cancelled."},{item:s.label??s.documentId}))},u=ae(d,"RelationsList"),f=!re.includes(I),b=t.length>W?Math.min(t.length,W)*(H+K)+H/2:Math.min(t.length,W)*(H+K);return c.jsxs(We,{$overflowDirection:O,children:[c.jsx(ne,{id:R,children:y({id:F("dnd.instructions"),defaultMessage:"Press spacebar to grab and re-order"})}),c.jsx(ne,{"aria-live":"assertive",children:L}),c.jsx(ke,{height:b,ref:M,outerRef:w,itemCount:t.length,itemSize:H+K,itemData:{ariaDescribedBy:R,canDrag:f,disabled:o,handleCancel:p,handleDropItem:h,handleGrabItem:l,handleMoveItem:r,name:d,handleDisconnect:u,relations:t},itemKey:i=>t[i].id,innerElementType:"ol",children:pt})]})},We=Q(q)`
  position: relative;
  overflow: hidden;
  flex: 1;

  &:before,
  &:after {
    position: absolute;
    width: 100%;
    height: 4px;
    z-index: 1;
  }

  &:before {
    /* TODO: as for DS Table component we would need this to be handled by the DS theme */
    content: '';
    background: linear-gradient(rgba(3, 3, 5, 0.2) 0%, rgba(0, 0, 0, 0) 100%);
    top: 0;
    opacity: ${({$overflowDirection:t})=>t==="top-bottom"||t==="top"?1:0};
    transition: opacity 0.2s ease-in-out;
  }

  &:after {
    /* TODO: as for DS Table component we would need this to be handled by the DS theme */
    content: '';
    background: linear-gradient(0deg, rgba(3, 3, 5, 0.2) 0%, rgba(0, 0, 0, 0) 100%);
    bottom: 0;
    opacity: ${({$overflowDirection:t})=>t==="top-bottom"||t==="bottom"?1:0};
    transition: opacity 0.2s ease-in-out;
  }
`,ht=Q(me)`
  & > span {
    font-size: ${({theme:t})=>t.fontSizes[2]};
  }
`,ft=({data:t,index:n,style:o})=>{const{ariaDescribedBy:d,canDrag:m=!1,disabled:I=!1,handleCancel:R,handleDisconnect:y,handleDropItem:M,handleGrabItem:w,handleMoveItem:O,name:T,relations:L}=t,{formatMessage:_}=V(),{id:v,label:e,status:r}=L[n],[{handlerId:l,isDragging:h,handleKeyDown:p},u,f,b,i]=De(m&&!I,{type:`${Le.RELATION}_${T}`,index:n,item:{displayedValue:e,status:r,id:v,index:n},onMoveItem:O,onDropItem:M,onGrabItem:w,onCancel:R,dropSensitivity:Oe.REGULAR}),s=xe(u,b);return C.useEffect(()=>{i(Fe())},[i]),c.jsx(q,{style:o,tag:"li",ref:f,"aria-describedby":d,cursor:m?"all-scroll":"default",children:h?c.jsx(Be,{}):c.jsxs(B,{paddingTop:2,paddingBottom:2,paddingLeft:m?2:4,paddingRight:4,hasRadius:!0,borderColor:"neutral200",background:I?"neutral150":"neutral0",justifyContent:"space-between",ref:s,"data-handler-id":l,children:[c.jsxs(Ue,{gap:1,children:[m?c.jsx(oe,{tag:"div",role:"button",tabIndex:0,withTooltip:!1,label:_({id:F("components.RelationInput.icon-button-aria-label"),defaultMessage:"Drag"}),variant:"ghost",onKeyDown:p,disabled:I,children:c.jsx(Me,{})}):null,c.jsxs(B,{width:"100%",minWidth:0,justifyContent:"space-between",children:[c.jsx(q,{minWidth:0,paddingTop:1,paddingBottom:1,paddingRight:4,children:c.jsx(Te,{description:e,children:c.jsx(ht,{onClick:()=>console.log("OPEN MODAL"),children:e})})}),r?c.jsx(he,{status:r}):null]})]}),c.jsx(q,{paddingLeft:4,children:c.jsx(oe,{onClick:()=>y(L[n]),disabled:I,label:_({id:F("relation.disconnect"),defaultMessage:"Remove"}),variant:"ghost",size:"S",children:c.jsx(we,{})})})]})})},pt=({data:t,index:n,style:o})=>{const{ariaDescribedBy:d,canDrag:m=!1,disabled:I=!1,handleCancel:R,handleDisconnect:y,handleDropItem:M,handleGrabItem:w,handleMoveItem:O,name:T,relations:L}=t,{formatMessage:_}=V(),{href:v,id:e,label:r,status:l}=L[n],[{handlerId:h,isDragging:p,handleKeyDown:u},f,b,i,s]=De(m&&!I,{type:`${Le.RELATION}_${T}`,index:n,item:{displayedValue:r,status:l,id:e,index:n},onMoveItem:O,onDropItem:M,onGrabItem:w,onCancel:R,dropSensitivity:Oe.REGULAR}),S=xe(f,i);return C.useEffect(()=>{s(Fe())},[s]),c.jsx(q,{style:o,tag:"li",ref:b,"aria-describedby":d,cursor:m?"all-scroll":"default",children:p?c.jsx(Be,{}):c.jsxs(B,{paddingTop:2,paddingBottom:2,paddingLeft:m?2:4,paddingRight:4,hasRadius:!0,borderColor:"neutral200",background:I?"neutral150":"neutral0",justifyContent:"space-between",ref:S,"data-handler-id":h,children:[c.jsxs(Ue,{gap:1,children:[m?c.jsx(oe,{tag:"div",role:"button",tabIndex:0,withTooltip:!1,label:_({id:F("components.RelationInput.icon-button-aria-label"),defaultMessage:"Drag"}),variant:"ghost",onKeyDown:u,disabled:I,children:c.jsx(Me,{})}):null,c.jsxs(B,{width:"100%",minWidth:0,justifyContent:"space-between",children:[c.jsx(q,{minWidth:0,paddingTop:1,paddingBottom:1,paddingRight:4,children:c.jsx(Te,{description:r,children:v?c.jsx(gt,{tag:Xe,to:v,isExternal:!1,children:r}):c.jsx(Ce,{textColor:I?"neutral600":"primary600",ellipsis:!0,children:r})})}),l?c.jsx(he,{status:l}):null]})]}),c.jsx(q,{paddingLeft:4,children:c.jsx(oe,{onClick:()=>y(L[n]),disabled:I,label:_({id:F("relation.disconnect"),defaultMessage:"Remove"}),variant:"ghost",size:"S",children:c.jsx(we,{})})})]})})},Ue=Q(B)`
  width: 100%;
  /* Used to prevent endAction to be pushed out of container */
  min-width: 0;

  & > div[role='button'] {
    cursor: all-scroll;
  }
`,St=Q.button`
  svg path {
    fill: ${({theme:t,disabled:n})=>n?t.colors.neutral600:t.colors.neutral500};
  }

  &:hover svg path,
  &:focus svg path {
    fill: ${({theme:t,disabled:n})=>!n&&t.colors.neutral600};
  }
`,gt=Q(Ke)`
  display: block;

  & > span {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display: block;
  }
`,Be=()=>c.jsx(q,{paddingTop:2,paddingBottom:2,paddingLeft:4,paddingRight:4,hasRadius:!0,borderStyle:"dashed",borderColor:"primary600",borderWidth:"1px",background:"primary100",height:`calc(100% - ${K}px)`}),Rt=C.memo(dt),Ct=C.memo(ct);export{yt as C,St as D,Ue as F,gt as L,Ct as M,Rt as a,$e as u};
